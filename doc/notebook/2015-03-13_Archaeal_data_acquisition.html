<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

<title>Getting the archaeal sequence data and metadata</title>

<script type="text/javascript">
window.onload = function() {
  var imgs = document.getElementsByTagName('img'), i, img;
  for (i = 0; i < imgs.length; i++) {
    img = imgs[i];
    // center an image if it is the only element of its parent
    if (img.parentElement.childElementCount === 1)
      img.parentElement.style.textAlign = 'center';
  }
};
</script>





<style type="text/css">
body, td {
   font-family: sans-serif;
   background-color: white;
   font-size: 13px;
}

body {
  max-width: 800px;
  margin: auto;
  padding: 1em;
  line-height: 20px;
}

tt, code, pre {
   font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
}

h1 {
   font-size:2.2em;
}

h2 {
   font-size:1.8em;
}

h3 {
   font-size:1.4em;
}

h4 {
   font-size:1.0em;
}

h5 {
   font-size:0.9em;
}

h6 {
   font-size:0.8em;
}

a:visited {
   color: rgb(50%, 0%, 50%);
}

pre, img {
  max-width: 100%;
}
pre {
  overflow-x: auto;
}
pre code {
   display: block; padding: 0.5em;
}

code {
  font-size: 92%;
  border: 1px solid #ccc;
}

code[class] {
  background-color: #F8F8F8;
}

table, td, th {
  border: none;
}

blockquote {
   color:#666666;
   margin:0;
   padding-left: 1em;
   border-left: 0.5em #EEE solid;
}

hr {
   height: 0px;
   border-bottom: none;
   border-top-width: thin;
   border-top-style: dotted;
   border-top-color: #999999;
}

@media print {
   * {
      background: transparent !important;
      color: black !important;
      filter:none !important;
      -ms-filter: none !important;
   }

   body {
      font-size:12pt;
      max-width:100%;
   }

   a, a:visited {
      text-decoration: underline;
   }

   hr {
      visibility: hidden;
      page-break-before: always;
   }

   pre, blockquote {
      padding-right: 1em;
      page-break-inside: avoid;
   }

   tr, img {
      page-break-inside: avoid;
   }

   img {
      max-width: 100% !important;
   }

   @page :left {
      margin: 15mm 20mm 15mm 10mm;
   }

   @page :right {
      margin: 15mm 10mm 15mm 20mm;
   }

   p, h2, h3 {
      orphans: 3; widows: 3;
   }

   h2, h3 {
      page-break-after: avoid;
   }
}
</style>



</head>

<body>
<h1>Getting the archaeal sequence data and metadata</h1>

<h2>Get data out of ARB</h2>

<p>This is redundant with what we saw for the bacterial data, but for completion&hellip;</p>

<blockquote>
<p>To create SSU Ref (ARB file), all sequences below 1,200 bases for Bacteria and
Eukarya and below 900 bases for Archaea or an alignment identity below 70 or an
alignment quality value below 50 have been removed from SSU Parc. All sequences
with a Pintail value &lt; 50 or an alignment quality value &lt; 75 have been assigned
to color group 1 in ARB (red). All Living Tree Project or  StrainInfo
typestrains have been assigned to color group 2 in ARB (light blue). From
<a href="http://www.arb-silva.de/documentation/release-119/">http://www.arb-silva.de/documentation/release-119/</a></p>
</blockquote>

<p>Within ARB, we will exclude color group 1, chloroplasts, and mitochondria.</p>

<p>To get good sequences&hellip;</p>

<ul>
<li>Go to search window</li>
<li>Set Search_Fields to &ldquo;ARB_color&rdquo; and use &ldquo;1&rdquo;; click on the equal sign to make it not equal</li>
<li>Hit Mark Listed, Unmark Rest button (N=1493493)</li>
<li>The problem with the taxonomies is that the sequences don&#39;t all have taxonomies. Need to figure
out which taxonomy to base the analysis on. Do the following searches&hellip;

<ul>
<li>ARB_color != 1 &amp; tax_rdp == &ldquo;<em>Archaea</em>&rdquo; (N=40288)</li>
<li>ARB_color != 1 &amp; tax_greengenes == &ldquo;<em>Archaea</em>&rdquo; (N=19795)</li>
<li>ARB_color != 1 &amp; tax_slv == &ldquo;<em>Archaea</em>&rdquo; (N=17641)</li>
<li>ARB_color != 1 &amp; tax_embl == &ldquo;<em>Archaea</em>&rdquo; (N=44574)</li>
<li>ARB_color != 1 &amp; (tax_rdp | tax_greengenes | tax_embl | tax_slv) (N=46387 )</li>
</ul></li>
</ul>

<p>Let&#39;s stick with the archaeal sequences that have an RDP taxonomy and we will
analyze them in RDP space, but we can always go back to the taxonomy provided by
the other systems if we&#39;d like. A quick spot checking suggests that the RDP
taxonomy information is actually richer than that of the EBML taxonomy
information.</p>

<ul>
<li>Return to Search and Query window</li>
<li>Change search field to &ldquo;ARB_color&rdquo;, enter &ldquo;1&rdquo;, and click the equal sign to be not-equal</li>
<li>Change the second search field to &ldquo;tax_rdp&rdquo; and set it to &ldquo;<em>Archaea</em>&rdquo;</li>
<li>Hit &ldquo;Search&rdquo;</li>
<li>Hit Mark Listed Unmark Rest (N=40,288)</li>
<li>Click &ldquo;Write to Fields of Listed&rdquo;, select the &ldquo;remark&rdquo; field, and enter &ldquo;good archaea&rdquo;</li>
<li>Click &ldquo;Write&rdquo;</li>
<li>In main ARB window go File-&gt;Export-&gt;Export to external format</li>
<li>Select Compress -&gt; &ldquo;Vertical Gaps&rdquo; and fasta_mothur.eft as the format</li>
<li>Rename <code>noname.fasta</code> to <code>archaea.fasta</code></li>
</ul>

<p>Now we need the taxonomy information.</p>

<ul>
<li>Go Tree -&gt; NDS</li>
<li>Click &ldquo;name&rdquo;, &ldquo;acc&rdquo;, &ldquo;tax_rdp&rdquo;. The &ldquo;tax_rdp&rdquo; field should have 250 characters</li>
<li>Unclick everything else</li>
<li>Click &ldquo;Close&rdquo;</li>
<li>Go File-&gt;Export-&gt;Export fields</li>
<li>Set the file name to &ldquo;archaea.taxonomy&rdquo; and Column output to &ldquo;TAB separated&rdquo;</li>
<li>Click &ldquo;SAVE&rdquo;</li>
</ul>

<p>Finally, let&#39;s save the database by doing File -&gt; Quick Save Changes and then
quit out of ARB.</p>

<h2>Format taxonomy file</h2>

<p>The next thing we need to do is to clean up the archaea.taxonomy.nds file
to make it into a proper, mothur compatible archaea.taxonomy file. First we
want to remove the names of any sub taxa (e.g. suborder). To do this we need
to get the RDP list of names and the taxonomic level they belong to&hellip;</p>

<p>Now we&#39;re read to do some R&#39;ing to get the taxonomy file formatted properly&hellip;</p>

<h2>Get good sequences</h2>

<p>Now we need to know the start/end position of the sequences so that we can
make sure the reads overlap the same alignment space.</p>

<pre><code class="bash">mothur &quot;#summary.seqs(fasta=archaea.fasta, processors=12)&quot;
</code></pre>

<pre><code>            Start    End    NBases  Ambigs  Polymer NumSeqs
Minimum:    1        4058   900     0       4   1
2.5%-tile:  357      4692   905     0       5   1008
25%-tile:   365      4783   935     0       5   10073
Median:     379      7409   1262    0       5   20145
75%-tile:   456      7729   1349    0       6   30217
97.5%-tile: 1746     7984   1470    4       7   39281
Maximum:    2321     8711   2174    46      32  40288
Mean:       513.659  6698.2 1185.3  0.3     5.44244
# of Seqs:  40288
</code></pre>

<p>Notes&hellip;</p>

<ul>
<li>Will want to get rid of sequences with large number of Ns in them and the
ridiculously long homopolymrs - how large?</li>
</ul>

<p>Now let&#39;s run these parameters using mothur.</p>

<h2>Single cell genomics data</h2>

<p>Using 16S rRNA gene sequences from the single cell genomics projects we&#39;d like
to see whether that type of data has had a meaningful impact on the trajectory
of the microbial census. The LSU team scraped these 251 sequences from a
database and have provided them to me as a fasta file. Some of them are quite
short and none of them are aligned. Let&#39;s go ahead and align them to the SILVA
alignment and then screen them to keep sequences that overlap with the SILVA
sequences.</p>

<h2>Pooling the data</h2>

<p>Now we want to merge the SILVA and single cell genomics 16S rRNA gene sequence
collections. We&#39;ll also filter the sequences to overlap in the same alignment
space, unique them, and precluster them&hellip;</p>

<p>Now we&#39;re ready to cluster the sequences. We&#39;ll do it by the classic approach
without any cutoffs and see what we get. Let&#39;s start by splitting things at the
phylum level and cluster from there&hellip;</p>

<h2>Get metadata</h2>

<p>We&#39;d like to use some metadata from the database to characterize the changes in
the representation of sequences over time, by environment, methods, etc. The
fields housed within SILVA are available at their <a href="http://www.arb-silva.de/fileadmin/arb_web_db/release_115/Fields_description/SILVA_description_of_fields_16_06_2013.htm">website</a>
and there is an <a href="http://www.arb-silva.de/documentation/faqs/">FAQ</a> on their site
as well. There were a number of fields that I didn&#39;t think were relevant and
instead focused on 30 fields that I thought could help the cause. I marked these
fields in the NDS feature and extracted them to <code>archaea_metadata.nds</code>. We need to
tweak this file slightly in R to get it into a format that we can use.</p>

<p>Now we want to read in <code>archaea.bad.accnos</code> so that we can figure out which
sequences to cull from the metadata table.</p>

<p>We&#39;d also like to get the metadata from the single cell data. We have an <code>xlsx</code> that the LSU group pulled together that we&#39;ll read in and concatenate to the end of <code>archaea.good.metadata</code>.</p>

</body>

</html>
